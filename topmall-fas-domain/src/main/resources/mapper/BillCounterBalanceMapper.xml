<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="topmall.fas.repository.BillCounterBalanceRepository"> 
    <!-- auto generate -->
    
    <resultMap id="baseResultMap" type="topmall.fas.model.BillCounterBalance">
           <id column="id" property="id" jdbcType="VARCHAR" />  
           <result column="bill_no" property="billNo" jdbcType="VARCHAR" />  
           <result column="company_no" property="companyNo" jdbcType="VARCHAR" />  
           <result column="shop_no" property="shopNo" jdbcType="VARCHAR" />  
           <result column="counter_no" property="counterNo" jdbcType="VARCHAR" />  
           <result column="supplier_no" property="supplierNo" jdbcType="VARCHAR" />  
           <result column="business_type" property="businessType" jdbcType="TINYINT" />  
           <result column="status" property="status" jdbcType="TINYINT" />  
           <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />  
           <result column="create_user" property="createUser" jdbcType="VARCHAR" />  
           <result column="auditor" property="auditor" jdbcType="VARCHAR" />  
           <result column="audit_time" property="auditTime" jdbcType="TIMESTAMP" />  
           <result column="remark" property="remark" jdbcType="VARCHAR" />  
           <result column="settle_month" property="settleMonth" jdbcType="VARCHAR" />  
           <result column="settle_start_date" property="settleStartDate" jdbcType="DATE" />  
           <result column="settle_end_date" property="settleEndDate" jdbcType="DATE" />  
           <result column="able_amount" property="ableAmount" jdbcType="DECIMAL" />  
           <result column="able_billing_amount" property="ableBillingAmount" jdbcType="DECIMAL" />  
           <result column="able_price_amount" property="ablePriceAmount" jdbcType="DECIMAL" />  
           <result column="able_tax_amount" property="ableTaxAmount" jdbcType="DECIMAL" />  
           <result column="able_tax_billing_amount" property="ableTaxBillingAmount" jdbcType="DECIMAL" />  
           <result column="able_tax_price_amount" property="ableTaxPriceAmount" jdbcType="DECIMAL" />  
           <result column="able_sum" property="ableSum" jdbcType="DECIMAL" />  
           <result column="able_billing_sum" property="ableBillingSum" jdbcType="DECIMAL" />  
           <result column="able_price_sum" property="ablePriceSum" jdbcType="DECIMAL" />  
           <result column="pre_able_sum" property="preAbleSum" jdbcType="DECIMAL" />  
           <result column="not_able_sum" property="notAbleSum" jdbcType="DECIMAL" />  
           <result column="pre_billing_sum" property="preBillingSum" jdbcType="DECIMAL" />  
           <result column="not_billing_sum" property="notBillingSum" jdbcType="DECIMAL" />  
           <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />  
           <result column="bill_type" property="billType" jdbcType="TINYINT" /> 
           <result column="profit_amount" property="profitAmount" jdbcType="DECIMAL" />  
           <result column="settle_amount" property="settleAmount" jdbcType="DECIMAL" />  
           <result column="cost_amount" property="costAmount" jdbcType="DECIMAL" /> 
           <result column="print_count" property="printCount" jdbcType="TINYINT" /> 
           <result column="type" property="type" jdbcType="TINYINT" /> 
    </resultMap>      
    
    
    <sql id="column_list"> 
        id,bill_no,company_no,shop_no,counter_no,supplier_no,business_type,status,create_time,create_user,auditor,audit_time,remark,settle_month,settle_start_date,settle_end_date,able_amount,able_billing_amount,able_price_amount,able_tax_amount,able_tax_billing_amount,able_tax_price_amount,able_sum,able_billing_sum,able_price_sum,update_time,
        pre_able_sum,not_able_sum,pre_billing_sum,not_billing_sum,bill_type,profit_amount,settle_amount,cost_amount,print_count,type
    </sql>

    <sql id="condition">  1=1
	    <choose>
    		<when test="null!=params and null!=params.type and ''!=params.type and params.type=='2'.toString()">
    			-- and @Company!company_no
    		</when>
    		<otherwise>
    			-- and @Shop!shop_no
    		</otherwise>
	    </choose>
    	<if test="null!=params">
            <if test="null!=params.queryCondition and ''!=params.queryCondition">
    			And ${params.queryCondition}
    		</if>
    		<if test="null!=params.id and ''!=params.id">
    			And id=#{params.id}
    		</if>
    		<if test="null!=params.ids and ''!=params.ids">
    			And id in (${params.ids})
    		</if>
    		<if test="null!=params.billNo and ''!=params.billNo">
    			And bill_no=#{params.billNo}
    		</if>
    		<if test="null!=params.billNos">
    			And bill_no in 
				<foreach collection="params.billNos" item="item" index="index" open="(" separator="," close=")">
				#{item}
				</foreach>
    		</if>
    		<if test="null!=params.companyNo and ''!=params.companyNo">
    			And company_no=#{params.companyNo}
    		</if>
    		<if test="null!=params.shopNo and ''!=params.shopNo">
    			And shop_no=#{params.shopNo}
    		</if>
    		<if test="null!=params.counterNo and ''!=params.counterNo">
    			And counter_no=#{params.counterNo}
    		</if>
    		<if test="null!=params.supplierNo and ''!=params.supplierNo">
    			And supplier_no=#{params.supplierNo}
    		</if>
    		<if test="null!=params.businessType and ''!=params.businessType">
    			And business_type=#{params.businessType}
    		</if>
    		<if test="null!=params.printCount and ''!=params.printCount">
    			And print_count=#{params.printCount}
    		</if>
    		<if test="null!=params.status and ''!=params.status">
    			And status=#{params.status}
    		</if>
    		<if test="null!=params.targetStatus and ''!=params.targetStatus">
    			And status!=#{params.targetStatus}
    		</if>
    		<if test="null!=params.createTime and ''!=params.createTime">
    			And create_time=#{params.createTime}
    		</if>
    		<if test="null!=params.createUser and ''!=params.createUser">
    			And create_user=#{params.createUser}
    		</if>
    		<if test="null!=params.auditor and ''!=params.auditor">
    			And auditor=#{params.auditor}
    		</if>
    		<if test="null!=params.auditTime and ''!=params.auditTime">
    			And audit_time=#{params.auditTime}
    		</if>
    		<if test="null!=params.remark and ''!=params.remark">
    			And remark=#{params.remark}
    		</if>
    		<if test="null!=params.settleMonth and ''!=params.settleMonth">
    			And settle_month=#{params.settleMonth}
    		</if>
    		<if test="null!=params.settleStartDate and ''!=params.settleStartDate">
    			And settle_start_date=#{params.settleStartDate}
    		</if>
    		<if test="null!=params.settleEndDate and ''!=params.settleEndDate">
    			And settle_end_date=#{params.settleEndDate}
    		</if>
    		<if test="null!=params.ableAmount and ''!=params.ableAmount">
    			And able_amount=#{params.ableAmount}
    		</if>
    		<if test="null!=params.ableBillingAmount and ''!=params.ableBillingAmount">
    			And able_billing_amount=#{params.ableBillingAmount}
    		</if>
    		<if test="null!=params.ablePriceAmount and ''!=params.ablePriceAmount">
    			And able_price_amount=#{params.ablePriceAmount}
    		</if>
    		<if test="null!=params.ableTaxAmount and ''!=params.ableTaxAmount">
    			And able_tax_amount=#{params.ableTaxAmount}
    		</if>
    		<if test="null!=params.ableTaxBillingAmount and ''!=params.ableTaxBillingAmount">
    			And able_tax_billing_amount=#{params.ableTaxBillingAmount}
    		</if>
    		<if test="null!=params.ableTaxPriceAmount and ''!=params.ableTaxPriceAmount">
    			And able_tax_price_amount=#{params.ableTaxPriceAmount}
    		</if>
    		<if test="null!=params.ableSum and ''!=params.ableSum">
    			And able_sum=#{params.ableSum}
    		</if>
    		<if test="null!=params.ableBillingSum and ''!=params.ableBillingSum">
    			And able_billing_sum=#{params.ableBillingSum}
    		</if>
    		<if test="null!=params.ablePriceSum and ''!=params.ablePriceSum">
    			And able_price_sum=#{params.ablePriceSum}
    		</if>
    		<if test="null!=params.updateTime and ''!=params.updateTime">
    			And update_time=#{params.updateTime}
    		</if>
    		<if test="null!=params.saleDate and ''!=params.saleDate ">
    			And settle_start_date &gt;=  #{params.saleDate}
    			And settle_end_date &lt;= #{params.saleDate}
    		</if>
    		<if test="null!=params.billType and ''!=params.billType">
    			And bill_type=#{params.billType}
    		</if>
    		<if test="null!=params.profitAmount and ''!=params.profitAmount">
    			And profit_amount=#{params.profitAmount}
    		</if>
    		<if test="null!=params.settleAmount and ''!=params.settleAmount">
    			And settle_amount=#{params.settleAmount}
    		</if>
    		<if test="null!=params.costAmount and ''!=params.costAmount">
    			And cost_amount=#{params.costAmount}
    		</if>
    		<if test="null!=params.type and ''!=params.type">
    			And type=#{params.type}
    		</if>
    		<if test="null!=params.zoneNo and ''!=params.zoneNo">
    			And company_no in (select zone_no from mdm_company where zone_no = #{params.zoneNo})
    		</if>
        </if>
    </sql>
    
    <sql id="uniqe_condition">   
        1=1  
        <if test="null!=params.billNo and ''!=params.billNo">
    			And bill_no=#{params.billNo}
    	</if>
    </sql>
    
    
    <select id="findByPrimaryKey" resultMap="baseResultMap" > 
		SELECT
		<include refid="column_list" />
		FROM fas_bill_counter_balance
		WHERE id = #{id};
	</select>
    
    <select id="findByUnique" resultMap="baseResultMap" > 
		SELECT
		<include refid="column_list" />
		FROM fas_bill_counter_balance
		WHERE  <include refid="uniqe_condition" />
	</select>
	
	<select id="getLastCounterBalanceDate" resultMap="baseResultMap" parameterType="map">
		SELECT
		<include refid="column_list" />
		FROM fas_bill_counter_balance
		WHERE  <include refid="condition" />
		order by settle_end_date desc
		limit 1
	</select>
    
    <select id="findByParam" resultMap="baseResultMap" parameterType="map"> 
		SELECT
		<include refid="column_list" />
		FROM fas_bill_counter_balance
		WHERE  <include refid="condition" />
        
	</select>
    
	<select id="selectCount" resultType="java.lang.Integer">
		SELECT COUNT(1) as s FROM fas_bill_counter_balance WHERE 
		<include refid="condition" />
	</select>
    
	<select id="selectByPage" resultMap="baseResultMap" parameterType="map">
		SELECT
		<include refid="column_list" />
		FROM fas_bill_counter_balance WHERE 
		<include refid="condition" />
		<if test="orderby != null and ''!=orderby">
			ORDER BY ${orderby}  
		</if>
		LIMIT #{page.startRowNum} ,#{page.pageSize}
	</select>
	
	
	<select id="selectByPageTotal" resultMap="baseResultMap" parameterType="map">
		SELECT
			'合计:' AS settle_month,
			SUM(ROUND(t.able_sum,2)) AS able_sum,
			SUM(ROUND(t.pre_able_sum,2)) AS pre_able_sum,
			SUM(ROUND(t.not_able_sum,2)) AS not_able_sum,
			SUM(ROUND(t.able_billing_sum,2)) AS able_billing_sum,
			SUM(ROUND(t.pre_billing_sum,2)) AS pre_billing_sum,
			SUM(ROUND(t.not_billing_sum,2)) AS not_billing_sum,
			sum(ROUND(t.profit_amount,2)) as profit_amount,
			sum(ROUND(t.settle_amount,2)) as settle_amount,
			sum(ROUND(t.cost_amount,2)) as cost_amount
		FROM (SELECT
			<include refid="column_list" />
			FROM fas_bill_counter_balance WHERE 
			<include refid="condition" />
			<if test="orderby != null and ''!=orderby">
				ORDER BY ${orderby} 
			</if>
			LIMIT #{page.startRowNum} ,#{page.pageSize}) t
	</select>
	
    
	<select id="selectByParams" resultMap="baseResultMap" parameterType="map">
		SELECT
		<include refid="column_list" />
		FROM fas_bill_counter_balance WHERE 
		<include refid="condition" /> 
        <if test="orderby != null and ''!=orderby">
			ORDER BY ${orderby}
		</if>
	</select> 
    
    <delete id="deleteByPrimaryKey">
		DELETE FROM fas_bill_counter_balance
		WHERE id = #{id}
	</delete>
    
    <delete id="deleteByUnique">
		DELETE FROM fas_bill_counter_balance
		WHERE <include refid="uniqe_condition" />
	</delete> 
    
	<delete id="deleteByParams" parameterType="map">
		DELETE
		FROM fas_bill_counter_balance
		WHERE 
        <include refid="condition" />
         <if test="params.ids!=null and ''!=params.ids ">
			AND id in ( ${params.ids} )
		</if>
	</delete>
    
    <insert id="insert" parameterType="topmall.fas.model.BillCounterBalance"  >
		INSERT INTO fas_bill_counter_balance
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="billNo != null">
				bill_no,
			</if>
			<if test="shopNo != null">
				shop_no,
			</if>
			<if test="companyNo != null">
				company_no,
			</if>
			<if test="counterNo != null">
				counter_no,
				business_type,
			</if>
			<if test="supplierNo !=null">
				supplier_no,
			</if>
			<if test="status != null">
				status,
			</if>
			<if test="createTime != null">
				create_time,
			</if>
			<if test="createUser != null">
				create_user,
			</if>
			<if test="auditor != null">
				auditor,
			</if>
			<if test="auditTime != null">
				audit_time,
			</if>
			<if test="remark != null">
				remark,
			</if>
			<if test="settleMonth != null">
				settle_month,
			</if>
			<if test="settleStartDate != null">
				settle_start_date,
			</if>
			<if test="settleEndDate != null">
				settle_end_date,
			</if>
			<if test="ableAmount != null">
				able_amount,
			</if>
			<if test="ableBillingAmount != null">
				able_billing_amount,
			</if>
			<if test="ablePriceAmount != null">
				able_price_amount,
			</if>
			<if test="ableTaxAmount != null">
				able_tax_amount,
			</if>
			<if test="ableTaxBillingAmount != null">
				able_tax_billing_amount,
			</if>
			<if test="ableTaxPriceAmount != null">
				able_tax_price_amount,
			</if>
			<if test="ableSum != null">
				able_sum,
			</if>
			<if test="ableBillingSum != null">
				able_billing_sum,
			</if>
			<if test="ablePriceSum != null">
				able_price_sum,
			</if>
			<if test="preAbleSum != null">
				pre_able_sum,
			</if>
			<if test="notAbleSum != null">
				not_able_sum,
			</if>
			<if test="preBillingSum != null">
				pre_billing_sum,
			</if>
			<if test="notBillingSum != null">
				not_billing_sum,
			</if>
			<if test="billType != null">
				bill_type,
			</if>
			<if test="profitAmount != null">
				profit_amount,
			</if>
			<if test="settleAmount != null">
				settle_amount,
			</if>
			<if test="costAmount != null">
				cost_amount,
			</if>
			<if test="printCount != null">
				print_count,
			</if>
			<if test="type != null">
				type,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=","> 
			<if test="id != null">
				 #{id},
			</if>
			<if test="billNo != null">
				 #{billNo},
			</if>
			<if test="shopNo != null">
				 #{shopNo},
			</if>
			<if test="companyNo != null">
			 	#{companyNo},
			</if>
			<if test="counterNo != null">
				 #{counterNo},
				 (select business_type from  mdm_counter where counter_no= #{counterNo}),
			</if>
			<if test="supplierNo !=null">
				#{supplierNo},
			</if>
			<if test="status != null">
				 #{status},
			</if>
			<if test="createTime != null">
				 #{createTime},
			</if>
			<if test="createUser != null">
				 #{createUser},
			</if>
			<if test="auditor != null">
				 #{auditor},
			</if>
			<if test="auditTime != null">
				 #{auditTime},
			</if>
			<if test="remark != null">
				 #{remark},
			</if>
			<if test="settleMonth != null">
				 #{settleMonth},
			</if>
			<if test="settleStartDate != null">
				 #{settleStartDate},
			</if>
			<if test="settleEndDate != null">
				 #{settleEndDate},
			</if>
			<if test="ableAmount != null">
				 #{ableAmount},
			</if>
			<if test="ableBillingAmount != null">
				 #{ableBillingAmount},
			</if>
			<if test="ablePriceAmount != null">
				 #{ablePriceAmount},
			</if>
			<if test="ableTaxAmount != null">
				 #{ableTaxAmount},
			</if>
			<if test="ableTaxBillingAmount != null">
				 #{ableTaxBillingAmount},
			</if>
			<if test="ableTaxPriceAmount != null">
				 #{ableTaxPriceAmount},
			</if>
			<if test="ableSum != null">
				 #{ableSum},
			</if>
			<if test="ableBillingSum != null">
				 #{ableBillingSum},
			</if>
			<if test="ablePriceSum != null">
				 #{ablePriceSum},
			</if>
			<if test="preAbleSum != null">
				 #{preAbleSum},
			</if>
			<if test="notAbleSum != null">
				 #{notAbleSum},
			</if>
			<if test="preBillingSum != null">
				 #{preBillingSum},
			</if>
			<if test="notBillingSum != null">
				 #{notBillingSum},
			</if>
			<if test="billType != null">
				#{billType},
			</if>
			<if test="profitAmount != null">
				#{profitAmount},
			</if>
			<if test="settleAmount != null">
				#{settleAmount},
			</if>
			<if test="costAmount != null">
				#{costAmount},
			</if>
			<if test="printCount != null">
				#{printCount},
			</if>
			<if test="type != null">
				#{type},
			</if>
		</trim>
	</insert>
    
    <update id="update" parameterType="topmall.fas.model.BillCounterBalance">
		UPDATE fas_bill_counter_balance
		<set>
			<if test="billNo != null">
				bill_no = #{billNo},
			</if>
			<if test="companyNo != null">
				company_no = #{companyNo},
			</if>
			<if test="shopNo != null">
				shop_no = #{shopNo},
			</if>
			<if test="counterNo != null">
				counter_no = #{counterNo},
			</if>
			<if test="supplierNo != null">
				supplier_no = #{supplierNo},
			</if>
			<if test="businessType != null">
				business_type = #{businessType},
			</if>
			<if test="status != null">
				status = #{status},
			</if>
			<if test="createTime != null">
				create_time = #{createTime},
			</if>
			<if test="createUser != null">
				create_user = #{createUser},
			</if>
			<if test="auditor != null">
				auditor = #{auditor},
			</if>
			<if test="auditTime != null">
				audit_time = #{auditTime},
			</if>
			<if test="remark != null">
				remark = #{remark},
			</if>
			<if test="settleMonth != null">
				settle_month = #{settleMonth},
			</if>
			<if test="settleStartDate != null">
				settle_start_date = #{settleStartDate},
			</if>
			<if test="settleEndDate != null">
				settle_end_date = #{settleEndDate},
			</if>
			<if test="ableAmount != null">
				able_amount = #{ableAmount},
			</if>
			<if test="ableBillingAmount != null">
				able_billing_amount = #{ableBillingAmount},
			</if>
			<if test="ablePriceAmount != null">
				able_price_amount = #{ablePriceAmount},
			</if>
			<if test="ableTaxAmount != null">
				able_tax_amount = #{ableTaxAmount},
			</if>
			<if test="ableTaxBillingAmount != null">
				able_tax_billing_amount = #{ableTaxBillingAmount},
			</if>
			<if test="ableTaxPriceAmount != null">
				able_tax_price_amount = #{ableTaxPriceAmount},
			</if>
			<if test="ableSum != null">
				able_sum = #{ableSum},
			</if>
			<if test="ableBillingSum != null">
				able_billing_sum = #{ableBillingSum},
			</if>
			<if test="ablePriceSum != null">
				able_price_sum = #{ablePriceSum},
			</if>
			<if test="preAbleSum != null">
				 pre_able_sum=#{preAbleSum},
			</if>
			<if test="notAbleSum != null">
				 not_able_sum = #{notAbleSum},
			</if>
			<if test="preBillingSum != null">
				 pre_billing_sum=#{preBillingSum},
			</if>
			<if test="notBillingSum != null">
				 not_billing_sum=#{notBillingSum},
			</if>
			<if test="billType != null">
				bill_type = #{billType},
			</if>
			<if test="profitAmount != null">
				profit_amount = #{profitAmount},
			</if>
			<if test="settleAmount != null">
				settle_amount = #{settleAmount},
			</if>
			<if test="costAmount != null">
				cost_amount = #{costAmount},
			</if>
			<if test="printCount != null">
				print_count = #{printCount},
			</if>
		</set>
		WHERE id = #{id}
	</update>
    <!-- auto generate end-->
    
    <update id="updateStatus" parameterType="map">
    	update fas_bill_counter_balance 
    	<set>
			<if test="params.operate != null and params.user!=null">
				${params.operate} = #{params.user},
			</if>
			<if test="params.operateTime != null and params.time!=null">
				${params.operateTime}= #{params.time},
			</if>
			<if test="params.status != null">
				status = #{params.status},
			</if>
		</set>
    	where ${params.keyName} in
    	<foreach item="item" index="index" collection="params.keyValue" open="(" separator="," close=")">  
		 	#{item}  
		</foreach>
    	<if test="null!=params.originStatus and ''!=params.originStatus">
   			and status = #{params.originStatus}
   		</if>
    </update>
    
</mapper>
